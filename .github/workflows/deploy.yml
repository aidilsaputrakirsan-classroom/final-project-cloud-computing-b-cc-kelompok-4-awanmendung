name: ğŸš€ Auto Deploy ke STB

on:
  push:
    branches:
      - development

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§° Install zip utility
        run: sudo apt-get install zip -y

      - name: ğŸ“ Buat file ZIP untuk deploy
        run: |
          zip -r deploy.zip . -x ".git*" -x ".github*" -x "node_modules/*"

      - name: ğŸš€ Upload ke STB Server (DEBUG MODE)
        id: deploy
        env:
          REPO_NAME: ${{ github.repository }}
        run: |
          echo "ğŸš€ Uploading $REPO_NAME"
          
          echo "ğŸ“‚ Cek deploy.zip:"
          ls -lh deploy.zip

          echo "ğŸ” Mulai CURL (verbose mode)..."

          curl -v -k -m 60 --connect-timeout 10 \
            -X POST \
            -F "repo=$REPO_NAME" \
            -F "file=@deploy.zip" \
            "https://deploy.akhzafachrozy.my.id/"

      - name: âœ… Selesai
        run: |
          echo "ğŸ‰ Deploy job selesai (walaupun error, sekarang kita dapat debug penuh)"
